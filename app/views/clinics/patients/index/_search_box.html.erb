
<div id="search_box">
	<%= form_tag url_for, method: "get" do %>
	<% if @category == "notification" %>
	<%# pushnotificaiton is put at table_box %>
	<%= link_to "javascript: window.pushNotification();", class: "btnW" do %>
		回診推播(<span class="number">0</span>)
	<% end %>
	<% end %>
	<% if @category == "all" %>
		<%= select_field_tag "has_event_notification", @has_event_notification, {nil => "選擇加入推播狀態", 1 => "已加入推播", 0 => "未加入推播"}, onchange: "$(this).closest('form').submit();" %>
	<% end %>
	<div class="input_box">
		<%= hidden_field_tag "category", params[:category] %>
		<%= text_field_tag "key", params[:key], id: "search" %>
		<div class="search_result hidden">
		</div>
	</div>
	<% if @category == "all" %>
	<%= link_to "新增病患", url_for(action: :new), class: "btnBu" %>
	<% end %>
	<% end %>
</div>

<script type="text/javascript">
	$(function(){
		$("input#search").on("keydown", function(){
			var key = $(this).val();
			if(key.length){
				var path = "<%= url_for %>";
				path = path + "?key=" + key;
				$.getScript(path);
			} else {
				$("#search_box .search_result").html('');
			}
		});
		$("#search_box").on("click", ".search_result ul li", function(){
			var name = $(this).data("name");
			$("input#search").val(name);
			// $("#search_box .search_result").html('');
			$("#search_box").find('form').submit();
		});
	})
</script>

