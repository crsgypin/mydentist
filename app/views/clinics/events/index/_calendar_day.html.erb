<div id="calendar-day">
  <div class="header">
  </div>
  <div class="table_box">
    <div class="d-col">
      <div class="d-row">
      </div>
      <% (6..24).each do |hour| %>
      <% [0, 15, 30, 45].each do |minute| %>
      <% border_style ={0 => "border3", 15 => "border2", 30 => "border3", 45 => "border1"}[minute] %>
      <div class="d-row hour_minute_tr <%= border_style %>" data-hour="<%= hour %>">
        <% if minute%30 == 0 %>
        <%= hour_minute_format(hour, minute) %>
        <% end %>      
      </div>
      <% end %>
      <% end %>
    </div>
    <% @doctors.each do |doctor| %>
    <div class="d-col">
      <div class="d-row"><%= doctor.name  %></div>
      <% (6..24).each do |hour| %>
      <% [0, 15, 30, 45].each do |minute| %>
      <% border_style ={0 => "border3", 15 => "border2", 30 => "border3", 45 => "border1"}[minute] %>
      <% event = doctor.events.find{|a| a.date == @date && a.hour == hour && a.minute == minute} %>
      <div class="d-row hour_minute_tr <%= border_style %>" data-hour="<%= hour %>" style="margin-left: -20px; margin-right: -20px;">
        <% if event.present? %>
        <div class="patient_event">
          <div class="patient"><%= event.patient.name %></div>
          <div class="service"><%= event.service.name %></div>
        </div>
        <% end %>
      </div>
      <% end %>
      <% end %>
    </div>
    <% end %>

    <% if false %>
    <div class="d-row border1">
      <div class="d-col"></div>
      <% @doctors.each do |doctor| %>
      <div class="d-col"><%= doctor.name %></div>
      <% end %>
    </div>
    <% (6..24).each do |hour| %>
    <% [0, 15, 30, 45].each do |minute| %>
    <% border_style ={0 => "border3", 15 => "border2", 30 => "border3", 45 => "border1"}[minute] %>
    <div class="d-row hour_minute_tr <%= border_style %>" data-hour="<%= hour %>">
      <% if minute%30 == 0 %>
      <div class="d-col hour"><%= hour_minute_format(hour, minute) %></div>
      <% else %>
      <div class="d-col hour"> </div>
      <% end %>

      <% @doctors.each do |doctor| %>
      <% event = doctor.events.find{|a| a.date == @date && a.hour == hour && a.minute == minute} %>
      <div class="d-col">
        <% if event.present? %>
        <div class="patient_event">
          <div class="patient"><%= event.patient.name %></div>
          <div class="service"><%= event.service.name %></div>
        </div>
        <% end %>
      </div>
      <% end %>
    </div>
    <% end %>
    <% end %>
    <% end %>
  </div>
</div>
<script type="text/javascript">
  $(function(){
    $(".day_btn").on("click", function(e){
      e.preventDefault();
      //btn
      $(".day_btn").removeClass("selected");
      $(this).addClass('selected');
      //table
      var s = $(this).data("start");
      var e = $(this).data("end");
      $("#calendar-day table tr.hour_minute_tr").each(function(i, tr){
        var h = $(tr).data('hour');
        if(h >= s && h <= e){
          $(tr).removeClass('hidden');
        } else {
          $(tr).addClass('hidden');
        }
      });
    });
  })
</script>

